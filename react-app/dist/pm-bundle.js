!function(e){function t(t){for(var n,o,c=t[0],i=t[1],l=t[2],p=0,g=[];p<c.length;p++)o=c[p],s[o]&&g.push(s[o][0]),s[o]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);for(u&&u(t);g.length;)g.shift()();return a.push.apply(a,l||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,c=1;c<r.length;c++){var i=r[c];0!==s[i]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},s={2:0},a=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var c=window.webpackJsonp=window.webpackJsonp||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=i;a.push([516,0]),r()}({16:function(e,t,r){"use strict";r.d(t,"a",function(){return o});r(53);var n=r(5),s=r.n(n),a=r(3);const o=e=>{const t=(()=>window.auth2.currentUser.get())(),r=s()({googleIdToken:t.Zi.id_token},e);return fetch("https://midiana.lv:8086/?f="+r.func,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(r)}).then(e=>{if(e)return e.json();throw Error("Something bad is happening with server.")}).then(t=>{if((t.error||!t.hasOwnProperty("message"))&&e.hasOwnProperty("componentDispatch")){const r={isError:!0,errorMsg:t.error||"Something went wrong :/"};return e.componentDispatch(Object(a.y)(r)),Promise.reject(t.error)}return t}).catch(e=>{console.error(e)})}},3:function(e,t,r){"use strict";r.d(t,"d",function(){return n}),r.d(t,"b",function(){return s}),r.d(t,"i",function(){return a}),r.d(t,"j",function(){return o}),r.d(t,"q",function(){return c}),r.d(t,"k",function(){return i}),r.d(t,"e",function(){return l}),r.d(t,"g",function(){return u}),r.d(t,"h",function(){return p}),r.d(t,"m",function(){return g}),r.d(t,"l",function(){return d}),r.d(t,"a",function(){return h}),r.d(t,"f",function(){return y}),r.d(t,"p",function(){return m}),r.d(t,"c",function(){return f}),r.d(t,"o",function(){return b}),r.d(t,"n",function(){return v}),r.d(t,"w",function(){return w}),r.d(t,"r",function(){return E}),r.d(t,"B",function(){return K}),r.d(t,"D",function(){return S}),r.d(t,"C",function(){return O}),r.d(t,"u",function(){return D}),r.d(t,"v",function(){return I}),r.d(t,"x",function(){return M}),r.d(t,"s",function(){return k}),r.d(t,"z",function(){return j}),r.d(t,"t",function(){return C}),r.d(t,"A",function(){return P}),r.d(t,"y",function(){return A});r(80);const n="FETCH POSTS",s="ADD POST",a="LOGGED IN",o="LOG_OUT",c="SET SESSION",i="POSTS TO SHOW",l="INITIAL POSTS STATUS",u="LOAD DIALOGS",p="LOAD MESSAGES",g="SET DIALOG KEY",d="SET CURRENT DIALOG",h="ADD MY MESSAGES",y="INIT MY MESSAGES",m="SET MY MESSAGES",f="CHECK KEYS",b="SET KEYS",v="SET ERROR",w=()=>({type:o,loggedIn:!1,user:{}}),E=e=>({type:s,post:e}),K=e=>{let t=e.postsLength;return{type:l,postsLength:t}},S=e=>{let t=e.showPosts,r=e.showPostStep;return{type:i,showPosts:t,showPostStep:r}},O=e=>{return{session:e.session,user:e.user,type:c,loggedIn:!0}},D=e=>{let t=e.dialogs;return{type:u,dialogs:t}},I=e=>({type:p,messages:e}),M=e=>({type:d,currentDialog:e}),k=e=>({type:f,keysChecking:e}),j=e=>{let t=e.publicKeyB64,r=e.privateKeyB64;return{type:b,publicKey:t.trim(),privateKey:r.trim()}},C=e=>({type:g,string:e}),P=e=>({type:m,myMessages:e}),A=e=>({type:v,error:e})},304:function(e,t,r){"use strict";(function(e){var n=r(0),s=r(7),a=r(305),o=r(307),c=r(310);t.a=Object(s.b)(e=>({currentDialog:e.currentDialog}))(class extends n.Component{render(){return e.createElement("div",{className:"pm-container"},e.createElement(a.a,null),e.createElement("div",{className:"pm-body"},e.createElement(o.a,null),e.createElement("div",{className:"pm-text-field"},e.createElement(c.a,null))))}})}).call(this,r(0))},305:function(e,t,r){"use strict";(function(e){var n=r(0),s=r(16),a=r(7),o=r(3),c=r(306);t.a=Object(a.b)(e=>({dialogs:e.dialogs}))(class extends n.Component{constructor(e){super(e)}componentDidMount(){Object(s.a)({func:"getUserList"}).then(e=>{this.props.dispatch(Object(o.u)({dialogs:e.records}))}),Object(s.a)({func:"getPrivateMessages",encryption:"CryptHelper_v001"}).then(e=>{this.props.dispatch(Object(o.v)(e.records))})}render(){const t=[];return this.props.dialogs&&this.props.dialogs.map(r=>{t.push(e.createElement(c.a,{key:r.rowId,user:r}))}),e.createElement("div",{className:"pm-dialogs"},t)}})}).call(this,r(0))},306:function(e,t,r){"use strict";(function(e){var n=r(0),s=r(7),a=r(3);t.a=Object(s.b)(e=>({dialogs:e.dialogs,currentDialog:e.currentDialog,myMessages:e.myMessages}))(class extends n.Component{constructor(e){super(e),this.onClick=this.onClick.bind(this)}onClick(){return this.props.dispatch(Object(a.x)(this.props.user))}render(){let t="";return this.props.currentDialog&&this.props.currentDialog.rowId===this.props.user.rowId&&(t=" active"),e.createElement("div",{onClick:this.onClick,className:"dialog-wrapper"+t},e.createElement("div",{className:"dialog-inner"},e.createElement("div",{className:"dialog-user"},this.props.user.displayName," (",this.props.user.email,")")))}})}).call(this,r(0))},307:function(e,t,r){"use strict";(function(e){r(53),r(501),r(80);var n=r(0),s=r(7),a=r(308),o=r(48),c=r(3);const i=window.localStorage;t.a=Object(s.b)(e=>({currentDialog:e.currentDialog,currentDialogMessages:e.currentDialogMessages,user:e.user,keysChecking:e.keysChecking}))(class extends n.Component{constructor(e){super(e)}componentDidMount(){const e=e=>{const t=e.substring(0,e.length/2).replace(/[\/]/g,"@").replace(/[+]/g,"_"),r=e.substring(e.length/2,e.length).replace(/[\/]/g,"@").replace(/[+]/g,"_");fetch("https://keyvalue.immanuel.co/api/KeyVal/UpdateValue/7p6a4g00/".concat(btoa(this.props.user.getBasicProfile().getEmail()+"_1"),"/").concat(t),{method:"POST"}).then(e=>{200===e.status&&fetch("https://keyvalue.immanuel.co/api/KeyVal/UpdateValue/7p6a4g00/".concat(btoa(this.props.user.getBasicProfile().getEmail()+"_2"),"/").concat(r),{method:"POST"}).then(e=>{200===e.status&&console.log("VALUES SENT SUCCESSFULLY!")})})};i.getItem("myMessages")&&i.getItem("myMessages").length>3&&this.props.dispatch(Object(c.A)(JSON.parse(i.getItem("myMessages")))),i.getItem("privateKey")&&i.getItem("publicKey")?(e(i.getItem("publicKey")),this.props.dispatch(Object(c.z)({publicKeyB64:i.getItem("publicKey"),privateKeyB64:i.getItem("privateKey")}))):o.a.generateKeyB64().then(t=>{let r=t.privateKeyB64,n=t.publicKeyB64;i.setItem("publicKey",n),i.setItem("privateKey",r),e(n),this.props.dispatch(Object(c.z)({publicKeyB64:n,privateKeyB64:r}))}),(()=>{const e=this.props.user.getBasicProfile().getEmail(),t=i.getItem("publicKey");this.props.dispatch(Object(c.s)(!0)),clearInterval(window.chatUpdateIntervalId),window.chatUpdateIntervalId=setInterval(()=>{fetch("https://keyvalue.immanuel.co/api/KeyVal/GetValue/7p6a4g00/".concat(btoa(e+"_1"),"/"),{method:"GET"}).then(e=>e.text()).then(r=>{fetch("https://keyvalue.immanuel.co/api/KeyVal/GetValue/7p6a4g00/".concat(btoa(e+"_2"),"/"),{method:"GET"}).then(e=>e.text()).then(e=>{JSON.parse(r).replace(/[@]/g,"/").replace(/[_]/g,"+").trim()+JSON.parse(e).replace(/[@]/g,"/").replace(/[_]/g,"+").trim()===t?console.log("keys check successful, you can chat safely"):(console.log("wtf???? FBI?? CIA??? ITS NOT UR PUBLIC KEY, GGWP!#242DELETE"),clearInterval(window.chatUpdateIntervalId))})})},1e4)})()}componentWillUpdate(e){e.currentDialog&&fetch("https://keyvalue.immanuel.co/api/KeyVal/GetValue/7p6a4g00/".concat(btoa(e.currentDialog.email+"_1"),"/"),{method:"GET"}).then(e=>e.text()).then(t=>{t&&fetch("https://keyvalue.immanuel.co/api/KeyVal/GetValue/7p6a4g00/".concat(btoa(e.currentDialog.email+"_2"),"/"),{method:"GET"}).then(e=>e.text()).then(e=>{let r=JSON.parse(t).replace(/[@]/g,"/").replace(/[_]/g,"+").trim()+JSON.parse(e).replace(/[@]/g,"/").replace(/[_]/g,"+").trim();this.props.dispatch(Object(c.t)(r))})})}render(){return e.createElement("div",{className:"pm-messages"},e.createElement(a.a,null))}})}).call(this,r(0))},308:function(e,t,r){"use strict";(function(e){r(56),r(53),r(279),r(74);var n=r(33),s=r.n(n),a=r(0),o=r(7),c=r(309),i=r(48);const l=window.localStorage;t.a=Object(o.b)(e=>({currentDialog:e.currentDialog,currentDialogPublicKey:e.currentDialogPublicKey,myMessages:e.myMessages,messages:e.messages,privateKey:e.privateKey}))(class extends a.Component{constructor(e){super(e),this.state={asyncMessages:[]}}componentWillUpdate(e){this.props.currentDialog!==e.currentDialog&&this.setState({asyncMessages:[]})}async getAsyncMessages(){const e=[];if(this.props.currentDialogPublicKey)for(let r of Object.entries(this.props.messages)){var t=s()(r,2);let n=t[0],a=t[1];if(a.sender===this.props.currentDialog.email&&a.message&&a.message.split(":").length>1){let t;try{t=await i.a.decryptMessageB64(l.getItem("privateKey"),a.message)}catch(e){console.log("Invalid private key for these messages, eh.")}if(t){const r={author:a.sender,userMessage:!1,msg:t,date:a.dt,key:a.sender+n};e.push(r)}}}return e}render(){let t=[];this.props.currentDialog&&this.props.myMessages.length&&this.props.myMessages.map((e,r)=>{if(e.recipient===this.props.currentDialog.email){const n={author:e.author,userMessage:!0,msg:e.message,date:e.date,key:e.author+r};t.push(n)}}),this.getAsyncMessages().then(e=>{e.length>0&&!this.state.asyncMessages.length&&this.setState({asyncMessages:e})});const r=(t=t.concat(this.state.asyncMessages).sort((e,t)=>new Date(e.date)-new Date(t.date))).map(t=>e.createElement(c.a,{userMessage:t.userMessage,key:t.key,data:t}));return e.createElement("div",null,r)}})}).call(this,r(0))},309:function(e,t,r){"use strict";(function(e){var n=r(0),s=r(7);t.a=Object(s.b)(e=>({currentDialog:e.currentDialog}))(class extends n.Component{constructor(e){super(e)}render(){return e.createElement("div",{className:this.props.userMessage?"pm-msg-right":"pm-msg-left"},e.createElement("div",{className:"pm-msg"},e.createElement("span",null,this.props.data.author),e.createElement("p",null,this.props.data.msg)))}})}).call(this,r(0))},310:function(e,t,r){"use strict";(function(e){var n=r(5),s=r.n(n),a=r(0),o=r(7),c=r(16),i=r(3),l=r(48);const u=window.localStorage;t.a=Object(o.b)(e=>({currentDialog:e.currentDialog,currentDialogPublicKey:e.currentDialogPublicKey,myMessages:e.myMessages,publicKey:e.publicKey,privateKey:e.privateKey,user:e.user}))(class extends a.Component{constructor(e){super(e),this.state={text:""},this.onKeyDown=this.onKeyDown.bind(this),this.onInput=this.onInput.bind(this)}onInput(e){this.setState(s()({},this.state,{text:e.target.value}))}onKeyDown(e){if(13===e.keyCode){const t={message:this.state.text,author:this.props.user.getBasicProfile().getEmail(),recipient:this.props.currentDialog.email,date:new Date};if(e.target.value="",!u.getItem("myMessages")||u.getItem("myMessages").length<3)u.setItem("myMessages",JSON.stringify([t]));else{const e=JSON.parse(u.getItem("myMessages"));e.push(t),u.setItem("myMessages",JSON.stringify(e))}l.a.encryptMessageB64(this.props.currentDialogPublicKey,this.state.text).then(e=>{console.log("ENCRYPTED",e),Object(c.a)({func:"sendPrivateMessage",message:e,recipient:this.props.currentDialog.email,encryption:"CryptHelper_v001"})}),this.props.dispatch(Object(i.A)(JSON.parse(u.getItem("myMessages"))))}}render(){return e.createElement("textarea",{className:"pm-send-msg",onKeyDown:this.onKeyDown,onInput:this.onInput,disabled:!this.props.currentDialog})}})}).call(this,r(0))},48:function(e,t,r){"use strict";r(56),r(505),r(53),r(279),r(507),r(515),r(74);var n=r(33),s=r.n(n);let a={name:"AES-CTR",length:128,counter:new Uint8Array(16)},o={name:"RSA-OAEP",modulusLength:1408,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},c=e=>{let t="",r=new Uint8Array(e),n=r.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(r[e]);return window.btoa(t)},i=e=>{let t=atob(e),r=t.length,n=new Uint8Array(new ArrayBuffer(r));for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return n.buffer},l={base64toArrayBuffer:i,generateKey:()=>window.crypto.subtle.generateKey(o,!0,["encrypt","decrypt"]).then(e=>Promise.all([window.crypto.subtle.exportKey("pkcs8",e.privateKey),window.crypto.subtle.exportKey("spki",e.publicKey)])).then(e=>{let t=s()(e,2);return{privateKey:t[0],publicKey:t[1]}}),generateKeyB64:()=>l.generateKey().then(e=>{let t=e.privateKey,r=e.publicKey;return{privateKeyB64:c(t),publicKeyB64:c(r)}}),encryptMessage:(e,t)=>crypto.subtle.importKey("spki",e,o,!0,["encrypt"]).then(e=>(e=>window.crypto.subtle.generateKey(a,!0,["encrypt","decrypt"]).then(t=>{let r=(new TextEncoder).encode(e),n=window.crypto.subtle.encrypt(a,t,r),s=window.crypto.subtle.exportKey("jwk",t);return Promise.all([n,s])}).then(e=>{let t=s()(e,2),r=t[0];return{aesCtrKeyData:t[1],encryptedPm:r}}))(t).then(t=>{let r=t.aesCtrKeyData,n=t.encryptedPm,s=(new TextEncoder).encode(JSON.stringify(r));return window.crypto.subtle.encrypt(o,e,s).then(e=>({encryptedAesKey:e,encryptedPm:n}))})),encryptMessageB64:(e,t)=>{let r=i(e);return l.encryptMessage(r,t).then(e=>{let t=e.encryptedAesKey,r=e.encryptedPm;return c(t)+":"+c(r)})},decryptMessage:(e,t)=>{let r=t.encryptedAesKey,n=t.encryptedPm;return crypto.subtle.importKey("pkcs8",e,o,!0,["decrypt"]).then(t=>crypto.subtle.decrypt(o,t,r).catch(t=>{let n="Failed to decrypt AES part of the message using private key - "+t;return console.error(n,{privateKey:e,encryptedAesKey:r},t),Promise.reject(new Error(n))})).then(e=>{let t=JSON.parse((new TextDecoder).decode(e));return crypto.subtle.importKey("jwk",t,a,!0,["encrypt","decrypt"]).then(e=>crypto.subtle.decrypt(a,e,n))}).then(e=>(new TextDecoder).decode(e))},decryptMessageB64:(e,t)=>{let r=i(e),n=t.split(":"),a=s()(n,2),o=a[0],c=a[1],u=i(o),p=i(c);return l.decryptMessage(r,{encryptedAesKey:u,encryptedPm:p})}};t.a=l},516:function(e,t,r){"use strict";r.r(t);var n=r(0),s=r.n(n),a=r(12),o=r.n(a),c=r(7),i=r(44),l=(r(56),r(74),r(5)),u=r.n(l),p=r(3);const g={dialogs:[],currentDialog:null,currentDialogMessages:null,loggedIn:!1,user:null,myMessages:[],messages:[],keysChecking:!1,publicKey:null,privateKey:null};const d=Object(i.b)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p.q:return u()({},e,{loggedIn:t.loggedIn,session:t.session,user:t.user});case p.i:case p.j:return u()({},e,{loggedIn:t.loggedIn,user:t.user});case p.l:return u()({},e,{currentDialog:t.currentDialog});case p.m:return u()({},e,{currentDialogPublicKey:t.string});case p.g:return u()({},e,{dialogs:t.dialogs});case p.h:return u()({},e,{messages:t.messages});case p.f:return u()({},e,{myMessages:u()({},e.myMessages,{[t.id]:[]})});case p.p:return u()({},e,{myMessages:t.myMessages});case p.a:return u()({},e,{myMessages:u()({},e.myMessages,{[t.id]:[t.msgObj,...e.myMessages[t.id]]})});case p.c:return u()({},e,{keysChecking:t.keysChecking});case p.o:return u()({},e,{publicKey:t.publicKey,privateKey:t.privateKey});default:return u()({},e)}});d.subscribe(()=>{console.log(d.getState())});var h=r(59),y=r(304);var m=class extends n.Component{render(){return s.a.createElement(c.a,{store:d},s.a.createElement(h.a,{body:s.a.createElement(y.a,null)}))}};o.a.render(s.a.createElement(m,null),document.getElementById("pm-main"))},59:function(e,t,r){"use strict";(function(e){var n=r(0),s=r(60),a=r(76),o=r(7),c=r(3);t.a=Object(o.b)(e=>({loggedIn:e.loggedIn,user:e.user}))(class extends n.Component{constructor(e){super(e)}componentDidMount(){let e;const t=this.props.dispatch;gapi.load("auth2",function(){e=gapi.auth2.init({client_id:"521166378127-vhkak167b5ghngfkk5r6ukrq059njoo8.apps.googleusercontent.com"}).then(e=>e.isSignedIn.get()?(window.auth2=e,t(Object(c.C)({session:e,user:e.currentUser.get()}))):t(Object(c.w)()))})}getContext(){return this.props.loggedIn?this.props.body:this.props.user?e.createElement(s.a,null):e.createElement("div",{className:"loader"},e.createElement(a.BarLoader,{color:"#26A69A",width:200,height:5}))}render(){return this.getContext()}})}).call(this,r(0))},60:function(e,t,r){"use strict";(function(e){var n=r(5),s=r.n(n),a=r(0),o=r(7),c=r(3),i=r(16);t.a=Object(o.b)(e=>({loggedIn:e.loggedIn,user:e.user}))(class extends a.Component{constructor(e){super(e)}onSignIn(e){return function(t){const r=gapi.auth2.getAuthInstance();window.auth2=s()({},r),e(Object(c.C)({session:r,user:t})),Object(i.a)({func:"login"})}}componentDidMount(){const e=this.onSignIn(this.props.dispatch);gapi.signin2.render("google-signin",{scope:"profile email",width:240,height:50,longtitle:!0,theme:"dark",onsuccess:e})}render(){return e.createElement("div",{id:"login-panel"},e.createElement("div",{className:"login-wrapper"},e.createElement("div",{className:"login-title"},e.createElement("h1",null,"Choose login form")),e.createElement("div",{className:"login-body"},e.createElement("div",{id:"google-signin"}))))}})}).call(this,r(0))}});